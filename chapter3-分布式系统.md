# 第3章 分布式系统

*分布式系统涉及数据分布、复制、一致性、容错及分布式协议。*

## 3.1 基本概念

### 3.1.1 异常

*大规模分布式存储系统的一个核心问题在于自动容错。然而，服务器节点是不可靠的，网络也是不可靠的。*

1. 异常类型

(1) 服务器宕机

引发服务器宕机的原因可能是内存错误、服务器停电。

服务器重启节点后，节点将失去所有的内存信息。因此，设计存储系统时需要考虑如何通过读取持久化介质（如机械硬盘，固态硬盘）中的数据来恢复内存信息，从而恢复到宕机前的某个一致的状态。

(2) 网络异常

引发网络异常的原因可能是消息丢失、消息乱序（如采用UDP通信）或者网络包数据错误。考虑“网络分区”是一种特殊的异常。

设计容错系统的一个基本原则是：网络永远是不可靠的，任何一个消息只有收到对方的回复后才可认为发送成功，系统设计时总是假设网络将会出现异常并采用相应的处理措施。

(3) 磁盘故障

磁盘故障分为两种情况：磁盘损坏和磁盘数据错误。磁盘损坏时，将会丢失存储在上面的数据，，因而，分布式存储系统需要考虑将数据存储到多台服务器，即使其中一台服务器磁盘出现故障，也能从其他服务器上恢复数据。对于磁盘数据错误，往往可以采用校验和（checksum）机制解决，这样的机制既可以在操作系统层面实现，又可以在上层的分布式存储系统层面实现。

2. “超时”

由于网络异常的存在，分布式存储系统中请求结果存在“三态”的概念。如果某个节点向另一个节点发起RPC，这个RPC执行的结果有三种状态：“成功”、“失败”、“超时”（未知状态），也称为分布式存储系统的三态。
